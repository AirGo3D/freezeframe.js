var freezeframe=function(e){function t(e){var t;if(this.options={selector:".freezeframe",animation_play_duration:5e3,non_touch_device_trigger_event:"hover"},t="string"==typeof e?{selector:e}:e)for(attribute in t)attribute in this.options?this.options[attribute]=t[attribute]:console.warn('freezeframe : "'+attribute+'" not a valid option',t);return this.is_touch_device="ontouchstart"in window||"onmsgesturechange"in window,this}return t.prototype.capture=function(t){var r;if(void 0!==t)r=t;else{if(void 0===this.options.selector)return console.warn("freezeframe : no selector passed to capture function or set in freezeframe options"),!1;r=this.options.selector}for(void 0==this.images&&(this.images=e()),this.images=this.images.add(e("img"+r)),i=0;i<this.images.length;i++)"gif"!==this.images[i].src.split(".").pop().toLowerCase().substring(0,3)&&this.images.splice(i,1);return 0==this.images.length?(console.warn('freezeframe : no gifs found for selector "'+r+'"'),!1):this},t.prototype.setup=function(){var t=this,i=this.images.not(".freezeframe-setup");return i.each(function(t){var i=e(this);i.addClass("freezeframe-setup freezeframe-image"),$canvas=e("<canvas />",{"class":"freezeframe-canvas"}).attr({width:0,height:0}).insertBefore(i),i.add($canvas).wrapAll(e("<div />",{"class":"freezeframe-container"}))}),imagesLoaded(i).on("progress",function(i,r){t.process(e(r.img))}),this},t.prototype.process=function(t){var i=t.siblings("canvas"),r="transitionend webkitTransitionEnd oTransitionEnd otransitionend",s=t[0].clientWidth,a=t[0].clientHeight;return i.attr({width:s,height:a}).css({"margin-right":"-"+s+"px"}),context=i[0].getContext("2d"),context.mozImageSmoothingEnabled=!1,context.imageSmoothingEnabled=!1,context.drawImage(t[0],0,0,s,a),i.addClass("freezeframe-ready").on(r,function(){e(this).off(r),t.addClass("freezeframe-ready")}),this},t.prototype.filter=function(t){var i;if(void 0!=t&&this.images.length>1){if(i=this.images.filter(e(t)),0==i.length)return console.warn('freezeframe : no gifs found for selector "'+t+'"'),!1}else i=this.images;return i},t.prototype.attach=function(t){var i,r;return i=this,this.filter(t).each(function(t){var s=e(this),a=e(this).siblings("canvas");(!i.is_touch_device&&"hover"==i.options.non_touch_device_trigger_event||i.is_touch_device)&&(a.mouseenter(function(){!function(){s.attr("src",s[0].src),a.removeClass("freezeframe-ready").addClass("freezeframe-active")}()}),a.mouseleave(function(){!function(){a.removeClass("freezeframe-active").addClass("freezeframe-ready")}()})),(!i.is_touch_device&&"click"==i.options.non_touch_device_trigger_event||i.is_touch_device)&&a.click(function(){!function(){var e=a.hasClass("freezeframe-active");e?(clearTimeout(r),a.removeClass("freezeframe-active").addClass("freezeframe-ready")):(s.attr("src",s[0].src),a.removeClass("freezeframe-ready").addClass("freezeframe-active"),r=setTimeout(function(){a.removeClass("freezeframe-active").addClass("freezeframe-ready")},i.options.animation_play_duration))}()})}),this},t.prototype.freeze=function(){this.capture().setup().attach()},t.prototype.trigger=function(t){this.filter(t).each(function(t){e(this).attr("src",e(this)[0].src),e(this).siblings("canvas").removeClass("freezeframe-ready").addClass("freezeframe-active")})},t.prototype.release=function(t){this.filter(t).each(function(t){e(this).siblings("canvas").removeClass("freezeframe-active").addClass("freezeframe-ready")})},t}(jQuery);